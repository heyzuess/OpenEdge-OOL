USING OOL.*.
USING OOL.WINFORM.*.
CLASS OOL.WINFORM.WINLOGIN INHERITS OOL.WINOBJ:
    DEFINE PROTECTED PROPERTY FRAME      AS WINFRAME  GET. PRIVATE SET.
    DEFINE PUBLIC    PROPERTY USERNAME   AS WINFILL   GET. PRIVATE SET.
    DEFINE PUBLIC    PROPERTY PASSWORD   AS WINFILL   GET. PRIVATE SET.
    DEFINE PUBLIC    PROPERTY LOGIN      AS WINBUTTON GET. PRIVATE SET.
    DEFINE PUBLIC    PROPERTY CANCEL     AS WINBUTTON GET. PRIVATE SET.

    DEFINE PROTECTED PROPERTY FORM-GO    AS LOGICAL   GET. PRIVATE SET.
    DEFINE PROTECTED PROPERTY FORM-EVENT AS CHARACTER GET. PRIVATE SET.
    DEFINE PROTECTED PROPERTY FORM-KEY   AS CHARACTER GET. PRIVATE SET.

    DEFINE PUBLIC    PROPERTY TITLE    AS CHARACTER GET. 
    PUBLIC SET (cip_title AS CHARACTER):
        ASSIGN THIS-OBJECT:TITLE = cip_title.
        IF THIS-OBJECT:TITLE > "" AND THIS-OBJECT:BOX THEN 
            ASSIGN THIS-OBJECT:BOX = FALSE.

        IF THIS-OBJECT:LIVE THEN
        DO:
            ASSIGN THIS-OBJECT:FRAME:TITLE = THIS-OBJECT:TITLE.
        END.
    END SET.

    DEFINE PUBLIC   PROPERTY BOX       AS LOGICAL GET.
    PUBLIC SET (lip_log AS LOGICAL):
        ASSIGN THIS-OBJECT:BOX = lip_log.
        IF THIS-OBJECT:TITLE > "" AND THIS-OBJECT:BOX THEN 
            ASSIGN THIS-OBJECT:TITLE = "".

        IF THIS-OBJECT:LIVE THEN
        DO:
            ASSIGN THIS-OBJECT:FRAME:BOX   = THIS-OBJECT:BOX.
        END.
    END SET.
    
    DEFINE PUBLIC OVERRIDE PROPERTY WIDTH AS INTEGER GET.
    PUBLIC SET (iip_width AS INTEGER):
        ASSIGN THIS-OBJECT:WIDTH = iip_width.

        IF THIS-OBJECT:LIVE THEN
        DO:
        END.
    END.

    DEFINE PUBLIC OVERRIDE PROPERTY HEIGHT AS INTEGER GET.
    PUBLIC SET (iip_height AS INTEGER):
        ASSIGN THIS-OBJECT:HEIGHT = iip_height.

        IF THIS-OBJECT:LIVE THEN
        DO:
        END.
    END.

    DEFINE PUBLIC OVERRIDE EVENT FOCUS-OFF SIGNATURE VOID (aip_data AS ARRAY).

    DEFINE PRIVATE VARIABLE o_data    AS ARRAY.
    DEFINE PRIVATE VARIABLE o_current AS WINOBJ.
    DEFINE PRIVATE VARIABLE i_current AS INTEGER.

    CONSTRUCTOR WINLOGIN ():
        SUPER().

    END CONSTRUCTOR.

    DESTRUCTOR WINLOGIN ():
    END DESTRUCTOR.

    METHOD PUBLIC VOID FORM-EVENT-HANDLER (INPUT aip_data AS ARRAY):
        ASSIGN THIS-OBJECT:FORM-EVENT = aip_data:INDEX-KEY(1)
               THIS-OBJECT:FORM-KEY   = aip_data:INDEX-CHAR(1)
               THIS-OBJECT:FORM-GO    = LOOKUP(THIS-OBJECT:FORM-KEY, "ENTER,RETURN")   > 0 AND
                                        LOOKUP(THIS-OBJECT:FORM-EVENT, "LOGIN,CANCEL") > 0.
    END METHOD.

    METHOD PUBLIC VOID ENABLE-ALL ():
        THIS-OBJECT:LOGIN:FOCUS-OFF:SUBSCRIBE(FORM-EVENT-HANDLER).
        THIS-OBJECT:CANCEL:FOCUS-OFF:SUBSCRIBE(FORM-EVENT-HANDLER).

        o_current = THIS-OBJECT:FRAME:GET-FIRST-CHILD().

        ENABLE-BLK:
        REPEAT:
            THIS-OBJECT:FORM-GO = FALSE.
            o_current:ENABLE().

            IF THIS-OBJECT:FORM-GO THEN
            DO:
                IF THIS-OBJECT:FORM-EVENT = "LOGIN" THEN
                DO:
                    o_data = NEW ARRAY().
                    o_data:PUSH-BACK("USERNAME", THIS-OBJECT:USERNAME:VALUE).
                    o_data:PUSH-BACK("PASSWORD", THIS-OBJECT:PASSWORD:VALUE).
                    THIS-OBJECT:FOCUS-OFF:PUBLISH(o_data).
                    LEAVE ENABLE-BLK.
                END.
                ELSE
                IF THIS-OBJECT:FORM-EVENT = "CANCEL" THEN
                DO:
                    THIS-OBJECT:FOCUS-OFF:PUBLISH(?).
                    LEAVE ENABLE-BLK.
                END.
            END.
            
            IF LOOKUP(THIS-OBJECT:FORM-EVENT, "LOGIN,CANCEL") > 0 THEN
            CASE THIS-OBJECT:FORM-KEY:
                WHEN "CURSOR-LEFT" THEN
                DO:
                    IF THIS-OBJECT:FORM-EVENT = "CANCEL" THEN
                        ASSIGN o_current = THIS-OBJECT:FRAME:GET-PREV-CHILD().
                END.
                WHEN "CURSOR-RIGHT" THEN
                DO:
                    IF THIS-OBJECT:FORM-EVENT = "LOGIN" THEN
                        ASSIGN o_current = THIS-OBJECT:FRAME:GET-NEXT-CHILD().
                END.
                WHEN "TAB" THEN
                DO:
                    ASSIGN o_current = THIS-OBJECT:FRAME:GET-NEXT-CHILD().
                END.
                OTHERWISE NEXT ENABLE-BLK.
            END CASE.
            ELSE ASSIGN o_current = THIS-OBJECT:FRAME:GET-NEXT-CHILD().
        END.

        THIS-OBJECT:LOGIN:FOCUS-OFF:UNSUBSCRIBE(FORM-EVENT-HANDLER).
        THIS-OBJECT:CANCEL:FOCUS-OFF:UNSUBSCRIBE(FORM-EVENT-HANDLER).
    END METHOD.

    METHOD PUBLIC OVERRIDE VOID ENABLE ():
    END METHOD.

    METHOD PUBLIC OVERRIDE VOID WAIT ():
    END METHOD.

    METHOD PUBLIC OVERRIDE LOGICAL REGISTER ():
        IF THIS-OBJECT:LIVE THEN
        DO:
        END.

        THIS-OBJECT:FRAME = NEW WINFRAME().
        ASSIGN THIS-OBJECT:FRAME:WIDTH   = THIS-OBJECT:WIDTH
               THIS-OBJECT:FRAME:HEIGHT  = THIS-OBJECT:HEIGHT
               THIS-OBJECT:FRAME:X       = THIS-OBJECT:X
               THIS-OBJECT:FRAME:Y       = THIS-OBJECT:Y
               THIS-OBJECT:FRAME:COLOR   = THIS-OBJECT:COLOR
               THIS-OBJECT:FRAME:TITLE   = THIS-OBJECT:TITLE
               THIS-OBJECT:FRAME:BOX     = THIS-OBJECT:BOX
               THIS-OBJECT:FRAME:VISIBLE = THIS-OBJECT:VISIBLE.
        THIS-OBJECT:FRAME:REGISTER().

        THIS-OBJECT:USERNAME = NEW WINFILL().
        ASSIGN THIS-OBJECT:USERNAME:WIDTH   = THIS-OBJECT:WIDTH - 2
               THIS-OBJECT:USERNAME:HEIGHT  = 1
               THIS-OBJECT:USERNAME:X       = THIS-OBJECT:WIDTH / 2 - THIS-OBJECT:USERNAME:WIDTH / 2
               THIS-OBJECT:USERNAME:Y       = THIS-OBJECT:HEIGHT / 3 - (THIS-OBJECT:USERNAME:HEIGHT + 1) / 3 - 1
               THIS-OBJECT:USERNAME:COLOR   = THIS-OBJECT:FRAME:COLOR
               THIS-OBJECT:USERNAME:VISIBLE = THIS-OBJECT:FRAME:VISIBLE
               THIS-OBJECT:USERNAME:PARENT  = THIS-OBJECT:FRAME.
        THIS-OBJECT:USERNAME:REGISTER().

        THIS-OBJECT:PASSWORD = NEW WINFILL().
        ASSIGN THIS-OBJECT:PASSWORD:WIDTH   = THIS-OBJECT:USERNAME:WIDTH
               THIS-OBJECT:PASSWORD:HEIGHT  = 1
               THIS-OBJECT:PASSWORD:X       = THIS-OBJECT:USERNAME:X
               THIS-OBJECT:PASSWORD:Y       = THIS-OBJECT:USERNAME:Y + 3
               THIS-OBJECT:PASSWORD:COLOR   = THIS-OBJECT:USERNAME:COLOR
               THIS-OBJECT:PASSWORD:VISIBLE = THIS-OBJECT:USERNAME:VISIBLE
               THIS-OBJECT:PASSWORD:PARENT  = THIS-OBJECT:FRAME.
        THIS-OBJECT:PASSWORD:REGISTER().

        THIS-OBJECT:PASSWORD:ADD-LABEL("Password").
        THIS-OBJECT:USERNAME:ADD-LABEL("Username").

        THIS-OBJECT:LOGIN  = NEW WINBUTTON(THIS-OBJECT:FRAME, "Login", 1, 1).
        THIS-OBJECT:LOGIN:NAME = "LOGIN".
        THIS-OBJECT:CANCEL = NEW WINBUTTON(THIS-OBJECT:FRAME, "Cancel", 1, 1).
        THIS-OBJECT:CANCEL:NAME = "CANCEL".

        ASSIGN THIS-OBJECT:CANCEL:X       = THIS-OBJECT:FRAME:WIDTH - THIS-OBJECT:CANCEL:WIDTH - 1.
               THIS-OBJECT:CANCEL:Y       = THIS-OBJECT:PASSWORD:Y + 2.
               THIS-OBJECT:LOGIN:X        = THIS-OBJECT:CANCEL:X - THIS-OBJECT:LOGIN:WIDTH.
               THIS-OBJECT:LOGIN:Y        = THIS-OBJECT:CANCEL:Y.
               THIS-OBJECT:CANCEL:VISIBLE = TRUE.
               THIS-OBJECT:LOGIN:VISIBLE  = TRUE.

        ASSIGN THIS-OBJECT:LIVE = VALID-HANDLE(THIS-OBJECT:FRAME:HANDLE).

        IF THIS-OBJECT:LIVE THEN
        DO:
            ASSIGN THIS-OBJECT:HANDLE = THIS-OBJECT:FRAME:HANDLE.
            THIS-OBJECT:ADD-CHILD(THIS-OBJECT:FRAME).
        END.

        RETURN THIS-OBJECT:LIVE.
    END METHOD.
END CLASS.
